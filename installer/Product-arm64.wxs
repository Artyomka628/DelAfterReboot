<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">

  <Product
    Id="15D2B191-236F-48DE-BC42-0770446FB639"
    Name="DelAfterReboot"
    Version="4.0.0"
    Manufacturer="Drygval Artyom"
    UpgradeCode="3aa0f3ee-e4a1-4030-b0b0-0245e4aedb57"
    Language="1033">

    <Package
      InstallerVersion="500"
      Compressed="yes"
      InstallScope="perMachine"
      Platform="arm64"/>

    <MajorUpgrade
      AllowDowngrades="no"
      DowngradeErrorMessage="Newer version is already installed."
      Schedule="afterInstallInitialize"/>

    <Media Id="1" Cabinet="product.cab" EmbedCab="yes" CompressionLevel="high"/>

    <UIRef Id="WixUI_InstallDir"/>
    <Property Id="WIXUI_INSTALLDIR" Value="INSTALLFOLDER"/>

    <Icon Id="AppIcon.ico" SourceFile="icon.ico"/>
    <Property Id="ARPPRODUCTICON" Value="AppIcon.ico" />

    <WixVariable Id="WixUILicenseRtf" Value="installer\license.rtf"/>
    <WixVariable Id="WixUIDialogBmp" Value="installer\banner.bmp"/>
    <WixVariable Id="WixUIBannerBmp" Value="installer\banner.bmp"/>

    <Directory Id="TARGETDIR" Name="SourceDir">
      <Directory Id="ProgramFiles64Folder">
        <Directory Id="INSTALLFOLDER" Name="DelAfterReboot">

          <Component Id="DelExe" Guid="0a642160-fa8a-44e8-9028-8d09588d9a68" Win64="yes">
            <File Id="DelExe" Source="$(var.DelExePath)" KeyPath="yes" />
          </Component>

          <Component Id="RegAndEnv" Guid="a036ae93-6b37-4f5f-8c6b-3b33224a5260" Win64="yes">
            <RegistryKey Root="HKLM" Key="Software\DelAfterReboot">
              <RegistryValue
                Name="InstallPath"
                Type="string"
                Value="[INSTALLFOLDER]"
                KeyPath="yes"/>
            </RegistryKey>
            <Environment
              Id="AddToPath"
              Name="PATH"
              Value="[INSTALLFOLDER]"
              Permanent="no"
              Part="last"
              Action="set"
              System="yes"/>
          </Component>

          <Component Id="ContextMenu" Guid="5581de34-b6e0-4da6-be1b-0d954f7b9ff3" Win64="yes">
            <RegistryKey
              Root="HKLM"
              Key="Software\Classes\Directory\shell\DelAfterReboot">
              <RegistryValue Type="string" Value="DelAfterReboot" KeyPath="yes"/>
              <RegistryValue Name="HasLUAShield" Type="string" Value=""/>
              <RegistryValue Name="Icon" Type="expandable" Value="[INSTALLFOLDER]delafterreboot.exe,0"/>
            </RegistryKey>

             <RegistryKey
              Root="HKLM"
              Key="Software\Classes\Directory\shell\DelAfterReboot\command">
              <RegistryValue
                Type="expandable"
                Value='"[INSTALLFOLDER]delafterreboot.exe" "%1" --uac'/>
            </RegistryKey>
          </Component>

        </Directory>
      </Directory>
    </Directory>

    <Feature Id="MainFeature" Title="DelAfterReboot" Level="1">
      <ComponentRef Id="DelExe"/>
      <ComponentRef Id="RegAndEnv"/>
      <ComponentRef Id="ContextMenu"/>
    </Feature>

  </Product>
</Wix>

