<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">

  <Product
    Id="BF381F5D-AD3A-4A7E-B6EA-BEAA749AC692"
    Name="DelAfterReboot"
    Version="3.0.0"
    Manufacturer="Drygval Artyom"
    UpgradeCode="3aa0f3ee-e4a1-4030-b0b0-0245e4aedb57"
    Language="1033">

    <Package
      InstallerVersion="500"
      Compressed="yes"
      InstallScope="perMachine"
      Platform="x86"/>

    <MajorUpgrade
      AllowDowngrades="no"
      DowngradeErrorMessage="Newer version is already installed."
      Schedule="afterInstallInitialize"/>

    <Media Id="1" Cabinet="product.cab" EmbedCab="yes" CompressionLevel="high"/>

    <UIRef Id="WixUI_InstallDir"/>
    <Property Id="WIXUI_INSTALLDIR" Value="INSTALLFOLDER"/>

    <WixVariable Id="WixUILicenseRtf" Value="installer\license.rtf"/>
    <WixVariable Id="WixUIDialogBmp" Value="installer\banner.bmp"/>
    <WixVariable Id="WixUIBannerBmp" Value="installer\banner.bmp"/>

    <Directory Id="TARGETDIR" Name="SourceDir">
      <Directory Id="ProgramFilesFolder">
        <Directory Id="INSTALLFOLDER" Name="DelAfterReboot">

          <Component Id="DelExe" Guid="78ad24a1-c0af-4041-80e1-58cff44daa06">
             <File Source="$(var.DelExePath)" KeyPath="yes"/>
          </Component>

          <Component Id="RegAndEnv" Guid="f0586a91-7d77-4462-9ac9-c4b6d24559b3">
            <RegistryKey Root="HKLM" Key="Software\DelAfterReboot">
              <RegistryValue
                Name="InstallPath"
                Type="string"
                Value="[INSTALLFOLDER]"
                KeyPath="yes"/>
            </RegistryKey>
            <Environment
              Id="AddToPath"
              Name="PATH"
              Value="[INSTALLFOLDER]"
              Permanent="no"
              Part="last"
              Action="set"
              System="yes"/>
          </Component>

          <Component Id="ContextMenu" Guid="a9cba8cd-796a-4e68-a6b9-b79ca23d2ee2">
            <RegistryKey
              Root="HKLM"
              Key="Software\Classes\Directory\shell\DelAfterReboot">
              <RegistryValue Type="string" Value="DelAfterReboot" KeyPath="yes"/>
              <RegistryValue Name="HasLUAShield" Type="string" Value=""/>
              <RegistryValue Name="Icon" Type="expandable" Value="[INSTALLFOLDER]delafterreboot.exe,0"/>
            </RegistryKey>

            <RegistryKey
              Root="HKLM"
              Key="Software\Classes\Directory\shell\DelAfterReboot\command">
              <RegistryValue
				Type="expandable"
				Value='"[INSTALLFOLDER]delafterreboot.exe" "%1"'/>
            </RegistryKey>
          </Component>

        </Directory>
      </Directory>
    </Directory>

    <Feature Id="MainFeature" Title="DelAfterReboot" Level="1">
      <ComponentRef Id="DelExe"/>
      <ComponentRef Id="RegAndEnv"/>
      <ComponentRef Id="ContextMenu"/>
    </Feature>

  </Product>
</Wix>